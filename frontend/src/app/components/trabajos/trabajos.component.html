<div class="dashboard-container">
    <!-- Sidebar/Menu Lateral -->
    <div class="sidebar">
        <div class="header">
            <img src="icons/usuario.png" alt="">
            <h3>{{ nombreUsuario }} {{ apellidoUsuario }}</h3>
            <p>Rol actual: {{ rolActivo ? rolActivo : 'Sin rol' }}</p>
          
            <!-- Selector de rol -->
            <div class="role-switcher">
                <select (change)="cambiarRol($event)" [value]="rolActivo">
                    <option *ngFor="let rol of roles" [value]="rol" [selected]="rol === rolActivo">
                    {{ rol }}
                    </option>
                </select>  
            </div>
        </div>
        
        <nav>
            <ul>
                <!-- Opción "Dashboard Administrador" -->
                <li>
                    <a (click)="navigateDashboard()">
                        <div style="display: flex; align-items: center;">
                            <i class="fa-solid fa-gauge-high" style="color: #050505; font-size: 20px; margin-right: 10px;"></i>
                            <span style="font-size: 20px; font-weight: bold; color: #050505;">Dashboard</span>
                        </div>
                    </a>
                </li>
        
                <!-- Menú "Citas" con submenú -->
                <li>
                    <a (click)="toggleMenu('citas')">
                        <div style="display: flex; align-items: center;">
                            <i class="fa-solid fa-calendar-alt" style="color: #050505; font-size: 18px; margin-right: 10px;"></i>
                            <span style="font-size: 18px; font-weight: bold; color: #050505;">Citas</span>
                        </div>
                    </a>
                    <ul *ngIf="showCitasMenu" class="submenu">
                        <li class="submenu-item">
                            <a (click)="navigateCitasMecanico()">
                                <div style="display: flex; align-items: center;">
                                    <i class="fa-solid fa-calendar-check" style="color: #050505; font-size: 14px; margin-right: 8px;"></i>
                                    <span style="font-size: 14px; color: #050505;">Ver Citas</span>
                                </div>
                            </a>
                        </li>
                    </ul>
                </li>
        
                <!-- Menú "Trabajos" con submenú -->
                <li>
                    <a (click)="toggleMenu('trabajos')">
                            <div style="display: flex; align-items: center;">
                                <i class="fa-solid fa-toolbox" style="color: #050505; font-size: 18px; margin-right: 10px;"></i>
                            <span style="font-size: 18px; font-weight: bold; color: #050505;">Trabajos</span>
                        </div>
                    </a>
                    <ul *ngIf="showTiposnMenu" class="submenu">
                        <li class="submenu-item">
                            <a (click)="navigateTrabajos()">
                                <div style="display: flex; align-items: center;">
                                    <i class="fa-solid fa-plus-circle" style="color: #050505; font-size: 14px; margin-right: 8px;"></i>
                                    <span style="font-size: 14px; color: #050505;">Ver Trabajos</span>
                                </div>
                            </a>
                        </li>
                    </ul>
                    <ul *ngIf="showTiposnMenu" class="submenu">
                        <li class="submenu-item">
                            <a (click)="navigateDiagnostico()">
                                <div style="display: flex; align-items: center;">
                                    <i class="fa-solid fa-plus-circle" style="color: #050505; font-size: 14px; margin-right: 8px;"></i>
                                    <span style="font-size: 14px; color: #050505;">Diagnóstico</span>
                                </div>
                            </a>
                        </li>
                    </ul>
                </li>
        
                <!-- Opción "Cerrar Sesión" -->
                <li>
                    <a (click)="logout()">
                        <div style="display: flex; align-items: center;">
                            <i class="fa-solid fa-right-from-bracket" style="color: #050505; font-size: 18px; margin-right: 10px;"></i>
                            <span style="font-size: 18px; font-weight: bold; color: #050505;">Cerrar Sesión</span>
                        </div>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Reloj al final del Sidebar -->
        <div class="reloj-container">
            <i class="fas fa-clock"></i>
            <span>{{ tiempoRestante }}</span>
        </div>
    </div>
    
    <!-- Contenido Principal del Dashboard -->
    <div class="main-content">
        <button (click)="descargarReporte()" class="btn-download">Descargar Reporte en PDF</button>
        <div class="trabajos-container">
            <div class="card-wrapper" *ngFor="let trabajo of trabajos">
                <div class="card-black">
                    <!-- Sección de imagen (parte superior de la tarjeta) -->
                    <igx-card-media height="150px">
                        <img
                            [src]="'http://localhost:8000/' + (trabajo?.vehiculo?.imagen || 'default-image.png')"
                            alt="Imagen del vehículo"
                        />
                    </igx-card-media>
                    <!-- Encabezado de la tarjeta (Título y subtítulo) -->
                    <igx-card-header>
                        <h3 igxCardHeaderTitle>
                            {{ trabajo?.vehiculo?.marca || 'Sin marca' }} - {{ trabajo?.vehiculo?.modelo || 'Sin modelo' }}
                        </h3>                     
                    </igx-card-header>
            
                    <!-- Contenido principal -->
                    <igx-card-content>
                        <p>
                            <strong>Cliente:</strong>
                            {{ trabajo?.cita?.cliente?.nombre || 'Sin cliente' }} {{ trabajo?.cita?.cliente?.apellido || '' }}
                        </p>
                        <p>
                            <strong>Servicios Solicitados</strong>
                        </p>
                        <div *ngFor="let detalle of trabajo.detalles_servicios" style="margin-bottom:20px;">
                            <p>
                              <strong>{{ detalle.servicio.nombre }}</strong>
                              <strong>Progreso:</strong> {{ detalle.progreso }}%<br>
                              <strong>Descripción:</strong> {{ detalle.descripcion || 'Sin descripción' }}
                            </p>
                        </div>                          
                    </igx-card-content>

                    <!-- Sección de acciones (botones) -->
                    <mat-card-actions class="button-row">
                        <!-- Botón Diagnóstico (solo se muestra si la cita está en estado 'confirmada') -->
                        <button
                                mat-icon-button
                                class="custom-button accent-button"
                                *ngIf="trabajo?.cita?.estado === 'Diagnosticado' && esMecanicoAsignado(trabajo) && isDiagnostico(trabajo)"
                                (click)="abrirModalDiagnostico(trabajo)"
                                >
                            <mat-icon>medical_services</mat-icon>
                        </button>

                        <!-- Botones que se muestran únicamente cuando el estado NO es "diagnosticado" -->
                        <button
                            mat-icon-button
                                class="custom-button accent-button"
                                *ngIf="trabajo?.cita?.estado !== 'Diagnosticado'"
                                (click)="abrirModalActualizar(trabajo)"
                                >
                            <mat-icon>update</mat-icon>
                        </button>

                        <button
                            mat-icon-button
                                class="custom-button accent-button"
                                *ngIf="trabajo?.cita?.estado !== 'Diagnosticado'"
                                (click)="abrirModalDescripcion(trabajo)"
                                >
                            <mat-icon>description</mat-icon>
                        </button>

                        <button
                            mat-icon-button
                            class="custom-button warn-button"
                            *ngIf="trabajo?.cita?.estado !== 'Diagnosticado'"
                            (click)="finalizarTrabajo(trabajo)"
                        >
                            <mat-icon>done_all</mat-icon>
                      </button>
                      
                    </mat-card-actions>                    
                </div>
            </div>
        </div>
    </div>  
    <div class="status-guide-container">
        <div class="status-cards">
          <!-- Card para pendiente -->
          <div class="status-card status-pending">
            <div class="status-icon">
              <i class="fa-solid fa-hourglass-start"></i>
            </div>
            <div class="status-info">
              <h4>Pendiente</h4>
              <p>Todos los progresos están en 0%.</p>
            </div>
          </div>
      
          <!-- Card para en proceso -->
          <div class="status-card status-in-progress">
            <div class="status-icon">
              <i class="fa-solid fa-tools"></i>
            </div>
            <div class="status-info">
              <h4>En Proceso</h4>
              <p>Al menos un progreso mayor a 0%, pero no todos completados.</p>
            </div>
          </div>
      
          <!-- Card para completado -->
          <div class="status-card status-completed">
            <div class="status-icon">
              <i class="fa-solid fa-check-circle"></i>
            </div>
            <div class="status-info">
              <h4>Completado</h4>
              <p>Todos los progresos están en 100%.</p>
            </div>
          </div>
        </div>
    </div>
</div>   